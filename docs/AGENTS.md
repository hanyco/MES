# راهنمای ایجنت پروژه MES

این فایل برای آشنایی ایجنت‌ها و توسعه‌دهندگان با ساختار و قوانین اصلی مخزن **MES** تهیه شده است. با مطالعه و به‌روزرسانی این سند، می‌توان مطمئن بود که تمام افراد و ایجنت‌ها از دستورالعمل یکسانی پیروی می‌کنند.

## هدف پروژه

پروژه شامل دو بخش اصلی است:

1. **BCL**: مجموعه‌ای از کتابخانه‌های پایه برای کمک به توسعه نرم‌افزارهای مرتبط با MES.
2. **Code Generator**: ابزار تولید کد که با استفاده از WPF پیاده‌سازی شده و لایه‌های مختلف برنامه (API، CQRS، DTO و فرم‌های Blazor) را به صورت خودکار تولید می‌کند. اطلاعات متادیتای کدهای تولیدشده در دیتابیس ذخیره می‌شود تا بتوان آن‌ها را مجدداً بازتولید کرد.

## ساختار مخزن

```
MES/
 ├─ src/
 │   ├─ bcl/
 │   │   ├─ CodeGenLib
 │   │   ├─ CoreLib
 │   │   └─ Data
 │   └─ infra/
 │       └─ CodeGenerator (WPF)
 └─ docs/
     └─ AGENTS.md (این فایل)
```

- فایل `Directory.Build.props` تنظیمات کلی build را روی **.NET 10.0 preview** قرار می‌دهد.
- پروژه‌ها از ویژگی‌های preview زبان C# استفاده می‌کنند.

## راهنمای Build

برای build پروژه به **SDK .NET 10 preview** نیاز است. پس از نصب SDK مناسب می‌توان دستور زیر را اجرا کرد:

```bash
dotnet build MES20.slnx
```

در محیط فعلی ممکن است `dotnet` نصب نباشد؛ بنابراین قبل از اجرای دستورات build از وجود SDK اطمینان حاصل کنید.

## تست‌ها

در حال حاضر پروژه فاقد تست‌های واحد است. در صورت اضافه شدن تست‌ها، اجرای آن‌ها پیش از commit ضروری خواهد بود.

## نکات و پرسش‌های موجود

- کلاس `FieldDefinition` که در `DtoDefinition` استفاده شده، در مخزن موجود نیست. تعیین محل و پیاده‌سازی آن ضروری است.
- فایل‌های تکراری `RoslynExtensions.cs` در دو مسیر متفاوت قرار دارند. پیشنهاد می‌شود یکی از آن‌ها حذف یا ادغام شود تا از سردرگمی جلوگیری شود.
- برای تولید مجدد کد بر اساس متادیتای ذخیره‌شده، مشخصات دقیق دیتابیس و ساختار جداول نیاز به مستندسازی دارند.

## پیشنهادها

1. ایجاد یک فایل `README.md` در ریشه مخزن برای معرفی کلی پروژه و نحوه راه‌اندازی.
2. افزودن تست‌های واحد برای بخش‌های حیاتی، خصوصاً برای موتور تولید کد.
3. تعریف دستورالعمل‌های کدنویسی (مانند نام‌گذاری و ساختار پوشه‌ها) تا همه‌ی افراد و ایجنت‌ها از سبک یکسانی پیروی کنند.
4. مستندسازی نحوه‌ی استفاده از Code Generator و مثال‌هایی از خروجی‌های مورد انتظار.

## به‌روزرسانی فایل

لطفاً در صورت تغییر در معماری، دستورالعمل‌ها یا نیازهای پروژه، این فایل را ویرایش کنید تا همیشه به‌روز باشد.

## راهنمای Codex برای زیرساخت MES

این بخش خلاصه‌ای از مستند «Codex Guidelines for MES Infrastructure Project» است و به ایجنت‌ها کمک می‌کند تا کدهای تولیدی با ساختار پروژه منطبق باشند.

### معماری کلی

- **Flat CQRS** همراه با MediatR و Dapper
- عدم وجود Repository Pattern
- تولید خودکار لایه‌های API، CQRS، DTO و فرم‌های Blazor بر اساس نیاز کاربر

### قواعد الزامی

1. سادگی و مستقیم‌نویسی در اولویت است.
2. تمام Command و Queryها به صورت `record` تعریف شوند و Handlerها مستقیماً از `IDbConnection` و Dapper استفاده کنند.
3. متادیتای کدهای تولیدشده در دیتابیس ذخیره شود تا امکان بازتولید دقیق وجود داشته باشد.

### ساختار خروجی تولیدشده

1. **API Layer**: فراخوانی سادهٔ MediatR و مدیریت DTOهای ورودی و خروجی.
2. **CQRS Layer**: مدل ورودی و خروجی، به همراه Handler که دستورات SQL را با Dapper اجرا می‌کند.
3. **DTOs**: تمام DTOهای لازم برای تبادل داده تولید می‌شوند.
4. **Blazor UI**:
   - **List View**: قابلیت جستجو، صفحه‌بندی، افزودن و حذف.
   - **Detail View**: نمایش جزئیات، ویرایش و ایجاد موجودیت جدید.

### موارد ممنوع

- ایجاد Repository یا لایهٔ دادهٔ اضافی مجاز نیست.
- پیشنهاد تغییر معماری یا بهبودهایی خارج از این راهنما ارائه نشود.

### یادآوری

در صورت نیاز به جزئیات بیشتر، به سند اصلی «Codex Guidelines for MES Infrastructure Project» مراجعه کنید.
